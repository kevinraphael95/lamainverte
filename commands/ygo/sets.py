# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“Œ sets.py â€” Commande interactive !sets
# Objectif :
#   - Afficher tous les sets dâ€™une carte Yu-Gi-Oh!
#   - Navigation interactive entre les sets
#   - Utilise utils/card_utils pour toutes les requÃªtes API
# CatÃ©gorie : ğŸƒ Yu-Gi-Oh!
# AccÃ¨s : Public
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“¦ Imports nÃ©cessaires
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import discord
from discord.ext import commands
from discord.ui import View, Button

from utils.discord_utils import safe_send
from utils.card_utils import search_card

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ›ï¸ View â€” Pagination interactive des sets
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class SetsPagination(View):
    """Navigation interactive entre les sets dâ€™une carte."""

    def __init__(self, sets: list[dict], card_name: str):
        super().__init__(timeout=120)
        self.sets = sets
        self.index = 0
        self.card_name = card_name

    async def update_embed(self, interaction: discord.Interaction):
        s = self.sets[self.index]
        prix_cm = s.get("set_price", "N/A")
        rarity = s.get("set_rarity", "N/A")
        date = s.get("tcg_date", "Inconnue")

        embed = discord.Embed(
            title=f"{self.card_name} â€” Set {self.index + 1}/{len(self.sets)}",
            color=discord.Color.green()
        )
        embed.add_field(
            name=f"{s.get('set_name', 'Set inconnu')} ({s.get('set_code', '')})",
            value=f"RaretÃ© : {rarity}\nPrix : â‚¬{prix_cm}\nDate TCG : {date}",
            inline=False
        )
        await interaction.response.edit_message(embed=embed, view=self)

    @discord.ui.button(label="â¬…ï¸", style=discord.ButtonStyle.secondary)
    async def prev(self, interaction: discord.Interaction, button: Button):
        self.index = (self.index - 1) % len(self.sets)
        await self.update_embed(interaction)

    @discord.ui.button(label="â¡ï¸", style=discord.ButtonStyle.secondary)
    async def next(self, interaction: discord.Interaction, button: Button):
        self.index = (self.index + 1) % len(self.sets)
        await self.update_embed(interaction)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§  Cog principal
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class Sets(commands.Cog):
    """Commande !sets â€” Affiche tous les sets dâ€™une carte Yu-Gi-Oh!"""

    def __init__(self, bot: commands.Bot):
        self.bot = bot

    @commands.command(
        name="sets",
        help="ğŸ“¦ Affiche tous les sets dâ€™une carte avec raretÃ©, prix et date TCG."
    )
    async def sets(self, ctx: commands.Context, *, nom: str):
        carte, langue, message = await search_card(nom, self.bot.aiohttp_session)

        if message:
            await safe_send(ctx, message)
            return
        if not carte:
            await safe_send(ctx, f"âŒ Impossible de trouver la carte `{nom}`.")
            return

        sets = carte.get("card_sets", [])
        if not sets:
            await safe_send(ctx, "âŒ Aucun set disponible pour cette carte.")
            return

        # Premier embed
        s = sets[0]
        prix_cm = s.get("set_price", "N/A")
        rarity = s.get("set_rarity", "N/A")
        date = s.get("tcg_date", "Inconnue")

        embed = discord.Embed(
            title=f"{carte.get('name', 'Carte inconnue')} â€” Set 1/{len(sets)}",
            color=discord.Color.green()
        )
        embed.add_field(
            name=f"{s.get('set_name', 'Set inconnu')} ({s.get('set_code', '')})",
            value=f"RaretÃ© : {rarity}\nPrix : â‚¬{prix_cm}\nDate TCG : {date}",
            inline=False
        )

        await safe_send(ctx, embed=embed, view=SetsPagination(sets, carte.get('name')))

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”Œ Setup du Cog
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async def setup(bot: commands.Bot):
    cog = Sets(bot)
    for command in cog.get_commands():
        if not hasattr(command, "category"):
            command.category = "ğŸƒ Yu-Gi-Oh!"
    await bot.add_cog(cog)
